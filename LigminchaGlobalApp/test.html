<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>LigminchaGlobalApp Test</title>
		<script type="text/javascript" src="resources/jquery.js"></script>
		<script type="text/javascript" src="resources/underscore.js"></script>
		<script type="text/javascript" src="resources/backbone.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {

				lg = {};

				lg.template = function(template, args, target) {

					// Function to do the final rendering once the html is populated with the args
					function render(html, target) {
						var type = typeof target;
						if(type == 'string') $(target).html(html);
						else if(type == 'object') target.html(html);
						else if(type == 'function') target(html);
						else console.log('lg.template can\'t process type "' + type + '"');
					}

					// Create a list for the templates if not already existent
					if(!('templates' in this)) this.templates = [];

					// If the template is already loaded and compiled, process the final result immediately
					if(template in this.templates) render(this.templates[template](args), target);

					// Otherwise load the template, and when it's loaded compile it and return the result
					else {
						render('<div class="loading"></div>', target);
						$.ajax({
							type: 'GET',
							url: '/templates/' + template + '.html',
							context: this,
							dataType: 'html',
							success: function(html) {

								// Compile the template
								this.templates[template] = _.template(html);

								// Process the template with our args and send through the callback
								render(this.templates[template](args), target);
							}
						});
					}
					console.log(render);
				};

				lg.template( 'welcome-user', { data: { realname: 'Henry McFoobas' } }, '#foo' );
				
				console.log(render);
			
			});
		</script>
	</head>
	<body>
		<div id="foo"></div>
	</body>
</html>
